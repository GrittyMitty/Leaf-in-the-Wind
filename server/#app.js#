const Express = require ("express")();
const Http = require ("http").Server(Express);
const Socketio = require ("socket.io")(Http);

var position = {
    x:200,
    y:200
};

var diceNum = {5};

Socketio.on("connection", socket => {
    socket.emit("position", position)
    socket.emit("diceNum", diceNum)
    socket.on("setRandomDiceData", randomDiceData () {
        const randomDiceNum = Math.floor(Math.random() * 6) + 1;
        this.diceNum = randomDiceNum;
        Socketio.emit("diceNum", diceNum);
    })
    socket.on("setDice", setDice() {
            let count = 0;
            const timer = setInterval(() => {
                this.setRandomDiceData();
                if (count >= 6) {
                    clearInterval(timer);
                }
                count += 1;
            }, 150);
        Socketio.emit("setRandomDiceData", setRandomDiceData);
    })
    socket.on("move", data => {
        switch(data) {
        case "left":
            position.x -= 5;
            Socketio.emit ("position", position);
            break;
            case "right":
            position.x += 5;
            Socketio.emit ("position", position);
            break;
            case "up":
            position.y -= 5;
            Socketio.emit ("position", position);
            break;
            case "down":
            position.y += 5;
            Socketio.emit ("position", position);
            break;
        }
    });
});

Http.listen(3000, () => {
    console.log("Listening at :3000...");
});
